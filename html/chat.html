<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>WSSL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="index.css"/>
    <style type="text/css">
      /*<![CDATA[*/
      /*]]>*/
    </style>
    <script src="index.js"></script>
    <script type="text/javascript">
      /*<![CDATA[*/

      var serverPort = 5003;

      var nicknameId = undefined;
      var connectId = undefined;
      var messageId = undefined;
      var sendId = undefined;
      var disconnectId = undefined;
      var outputId = undefined;
      var webSocket = undefined;

      function init()
      {
        document.getElementById('server').innerHTML = serverName+':'+serverPort;
        nicknameId = document.getElementById('nickname');
        connectId = document.getElementById('connect');
        disconnectId = document.getElementById('disconnect');
        messageId = document.getElementById('message');
        sendId = document.getElementById('send');
        outputId = document.getElementById('output');
        abled();
      }

      function abled()
      {
        if(webSocket === undefined)
        {
          nicknameId.disabled = false;
          connectId.disabled = false;
          disconnectId.disabled = true;
          messageId.disabled = true;
          sendId.disabled = true;
        }
        else
        {
          nicknameId.disabled = true;
          connectId.disabled = true;
          disconnectId.disabled = false;
          messageId.disabled = false;
          sendId.disabled = false;
        }
      }

      function clean()
      {
        outputId.innerHTML = '';
      }

      function write(message)
      {
        var newData = document.createElement('p');
        newData.innerHTML = message;
        outputId.insertBefore(newData, outputId.firstChild);
      }

      function connect()
      {
        if(webSocket !== undefined)
          write('ERROR: already connected');
        webSocket = new WebSocket('ws://'+serverName+':'+serverPort+'/'+nicknameId.value);
        webSocket.onopen = function(event)
        {
          write("Connected");
          abled();
        };
        webSocket.onclose = function(event)
        {
          write("Disconnected");
          webSocket = undefined;
          abled();
        };
        webSocket.onmessage = function(event)
        {
          write(event.data);
        };
        webSocket.onerror = function(event)
        {
          write('Error: '+event.type);
        };
      }

      function disconnect()
      {
        if(webSocket === undefined)
          write('ERROR: not connected');
        webSocket.close();
      }

      function send()
      {
        if(webSocket === undefined)
          write('ERROR: not connected');
        webSocket.send(messageId.value);
        messageId.value = '';
      }

      /*]]>*/
    </script>
  </head>
  <body onload="init();">
    Server on "<span id="server"></span>" with <a href="https://github.com/chupcko/wssl/blob/master/examples/chat.c" target="_blank" class="link">source</a>
    <p/>
    <button onclick="clean();">Clean</button>
    Nickname: <input type="text" id="nickname"/>
    <button id="connect" onclick="connect();">Connect</button>
    <button id="disconnect" onclick="disconnect();">Disconnect</button>
    <input type="text" id="message"/>
    <button id="send" onclick="send();">Send</button>
    <div id="output" class="box"></div>
  </body>
</html>
