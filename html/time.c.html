<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>WSSL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="index.css"/>
    <style type="text/css">
      /*<![CDATA[*/
      /*]]>*/
    </style>
    <script src="index.js"></script>
    <script type="text/javascript">
      /*<![CDATA[*/
      /*]]>*/
    </script>
  </head>
  <body>
    demonstrations/time.c:
    <pre class="source">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;

#include "<span class="wssl">wssl</span>.h"

#define CALL(...)                         \
do                                        \
{                                         \
  <span class="wssl">wssl</span>_result_t _result_ = (__VA_ARGS__); \
  if(<span class="wssl">wssl</span>_result_is_not_ok(_result_))     \
  {                                       \
    <span class="wssl">wssl</span>_result_print(_result_, stderr);  \
    exit(EXIT_FAILURE);                   \
  }                                       \
}                                         \
while(false)                              \

#define OUTPUT_SIZE 64

void <b>on_client</b>(<span class="wssl">wssl</span>_client_t* client, void* local_extra_data)
{
  char output[OUTPUT_SIZE];
  snprintf(output, OUTPUT_SIZE, "t=%ld", (long)time(NULL));
  <span class="wssl">wssl</span>_client_send_text(client, output);
}

bool <b>on_tick</b>(<span class="wssl">wssl</span>_t* wssl)
{
  <span class="wssl">wssl</span>_for_each_client_call(wssl, &amp;<b>on_client</b>, NULL);
  return true;
}

int <b>main</b>(void)
{
  <span class="wssl">WSSL</span>_DECLARE(wssl);

  <span class="wssl">wssl</span>_set_sleep_in_mseconds(&amp;wssl, 500);
  <span class="wssl">wssl</span>_set_tick_callback(&amp;wssl, &amp;<b>on_tick</b>);

  CALL(<span class="wssl">wssl</span>_server_add(&amp;wssl, "0.0.0.0", 5003));
  CALL(<span class="wssl">wssl</span>_loop(&amp;wssl));
  CALL(<span class="wssl">wssl</span>_clean(&amp;wssl));

  return EXIT_SUCCESS;
}
</pre>
  </body>
</html>
